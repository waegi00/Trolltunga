@using Microsoft.AspNet.Identity
@model Trolltunga.Models.Channel
@{
    ViewBag.Title = "Index";
}

<div class="row">
    <div class="col-lg-2 full-height menu">
        <a href="@Url.Action("Dashboard","Project", new {id = Model.Project.Id})"><h3>@Model.Project.Name</h3></a>
        <div class="menu">
            <p>Channels<a href="@Url.Action("Create","Channel", new {projectId = Model.Project.Id})"><i class="fa fa-plus pull-right"></i></a></p>
            @foreach (var channel in Model.Project.Channels)
            {
                <a class="col-lg-12 no-padding-row" href="@Url.Action("Index","Channel",new {id = channel.Id})"><p><i class="fa fa-hashtag"></i> @channel.Name</p></a>
            }
        </div>
        <div class="menu">
            <p>Direct mesasges<a href=""><i class="fa fa-plus pull-right"></i></a></p>
            @foreach (var directChannel in Model.Project.DirectMessages.Where(x => x.ApplicationUsers.Select(y => y.Id).Contains(User.Identity.GetUserId())))
            {
                <p><i class="fa fa-dot-circle-o"></i> @directChannel.Name</p>
            }
        </div>
    </div>
    <div class="full-height col-lg-10 no-padding-row">
        <div class="messages-container">
            @foreach (var message in Model.Messages)
            {
                <div class="media">
                    <div class="media-left">
                        <a href="#">
                            <img class="media-object" src="http://via.placeholder.com/64x64">
                        </a>
                    </div>
                    <div class="media-body">
                        <h4 class="media-heading">@message.ApplicationUser.UserName</h4>
                        @message.Content
                    </div>
                </div>
            }
            @if (Model.Messages.Count == 0)
            {
                <div class="media">
                    <div class="media-left">
                        <a href="#">
                            <img class="media-object" src="http://via.placeholder.com/64x64">
                        </a>
                    </div>
                    <div class="media-body">
                        <h4 class="media-heading">Trolltunga Bot</h4>
                        Sei der Erste, der etwas schreibt!
                    </div>
                </div>
            }
        </div>
        <div class="media" id="input" style="margin-top: 0">
            <div class="media-left">
                <a href="#">
                    <img class="media-object" src="http://via.placeholder.com/64x64">
                </a>
            </div>
            <div class="media-body">
                <h4 class="media-heading">User Name</h4>
                Message
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $(".messages-container").animate({ scrollTop: $('.messages-container').prop("scrollHeight") }, 1000);

        $(window).resize(function () {
            $(".full-height").height($(window).height() - $(".full-height").offset().top);
            var inputHeight = parseInt($("#input").css("padding")) * 2 + $("#input").height();
            $(".messages-container").height(($(".full-height").height() - parseInt($(".messages-container").css("padding")) * 2) - inputHeight);
            console.log();
        });
        $(window).resize();
    });
</script>